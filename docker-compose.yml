version: "2.3"
services:

  # bash
  bash:
    container_name: bash
    image: realsense_ros:latest
    network_mode: "host"
    command: bash -c "bash"
    working_dir: /root/
    volumes:
      - ./catkin_ws:/root/catkin_ws
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - /etc/localtime:/etc/localtime:ro
      - /dev/input:/dev/input
      - /dev/bus/usb/:/dev/bus/usb/:rw
      - /tmp/.docker.xauth:/tmp/.docker.xauth:rw
    environment:
      - XAUTHORITY=/tmp/.docker.xauth
      - DISPLAY
      - QT_X11_NO_MITSHM=1
      - ROS_MASTER_URI=${ROS_MASTER_URI}
      - ROS_IP=${ROS_IP}
      - ROS_HOST_NAME=${ROS_HOST_NAME}
    privileged: true
    stdin_open: true
    tty: true

  # master
  master:
    container_name: master
    image: realsense_ros:latest
    network_mode: "host"
    command: roscore
    environment:
      - ROS_IP=${ROS_IP}
      - ROS_HOST_NAME=${ROS_HOST_NAME}
    tty: true

  # rviz
  rviz:
    container_name: rviz
    image: realsense_ros:latest
    network_mode: "host"
    command: bash -c 'rviz'
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - /etc/localtime:/etc/localtime:ro
      - /dev/input:/dev/input
      - /tmp/.docker.xauth:/tmp/.docker.xauth:rw
    environment:
      - XAUTHORITY=/tmp/.docker.xauth
      - DISPLAY
      - QT_X11_NO_MITSHM=1
      - ROS_MASTER_URI=${ROS_MASTER_URI}
      - ROS_IP=${ROS_IP}
      - ROS_HOST_NAME=${ROS_HOST_NAME}
    privileged: true
    tty: true
